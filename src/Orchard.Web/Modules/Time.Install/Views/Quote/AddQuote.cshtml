@model Time.Install.ViewModels.QuoteViewModel

@{
    Script.Require("jQueryUI_Accordion").AtFoot();
    ViewBag.Title = "Installation Quote";
}

<link href="~/Modules/Time.Install/Styles/jQueryCss.css" rel="stylesheet" />


<h2>@ViewBag.Title</h2>

<div align="right">
    @Html.ActionLink("Back to VSW Install Index", "Index", "Home")
</div>
<div align="right">
    @Html.ActionLink("Back to Aerial Quote List", "Index")
</div>

<h3>Aerial Quote Number: @Model.QuoteNum</h3>
<h4>@Model.InstallDescr</h4>
<hr />
@using (Html.BeginForm("AddQuoteConfirmed", "Quote", FormMethod.Post))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    @Html.HiddenFor(model => model.QuoteNum)
    @Html.HiddenFor(model => model.InstallDescr)
    @Html.HiddenFor(model => model.LiftFamilyId)

    <div class="container">
        <ul class="nav nav-pills nav-justified">
            <li class="active"><a data-toggle="tab" href="#tab1">Click here for Lift Quote (TIME Options)</a></li>
            <li><a data-toggle="tab" href="#tab2">Click here for Install Quote (VSW Options)</a></li>
            <li><a data-toggle="tab" href="#tab3">Click here to Add VSW Options Manually</a></li>
        </ul>

        <div class="tab-content">
            <div id="tab1" class="tab-pane fade in active">
                <hr />
                @Html.Partial("_AerialOptions", Model.AerialOptions)
            </div>
            <div id="tab2" class="tab-pane fade">
                <hr />
                <div id="accordion">
                    @foreach (var item in ViewBag.OptionGroups)
                    {
                        <h3>@item.GroupName</h3>
                        <div>
                            <table class="table">
                                <tr class="success">
                                    <th>Option</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Hours</th>
                                </tr>
                                @for (int i = 0; i < Model.Options.Count; i++)
                                {
                                    if (Model.Options[i].GroupId == item.Id)
                                    {
                                        <tr>
                                            <td>@Html.Label("options[" + @i + "].OptionName", Model.Options[i].OptionName)</td>
                                            @Html.Hidden("options[" + @i + "].Id", Model.Options[i].Id)
                                            @Html.Hidden("options[" + @i + "].OptionName", Model.Options[i].OptionName)
                                            @Html.Hidden("options[" + @i + "].LiftFamilyId", Model.Options[i].LiftFamilyId)
                                            @Html.Hidden("options[" + @i + "].GroupId", Model.Options[i].GroupId)
                                            <td>@Html.TextBox("options[" + @i + "].Quantity", Model.Options[i].Quantity)</td>
                                            <td>@Html.TextBox("options[" + @i + "].Price", Model.Options[i].Price)</td>
                                            <td>@Html.TextBox("options[" + @i + "].LaborHours", Model.Options[i].LaborHours)</td>
                                        </tr>
                                    }
                                }
                            </table>
                        </div>
                    }
                </div>
            </div>
            <div id="tab3" class="tab-pane fade">
                <hr />
                <div class="alert alert-danger">
                    <p>
                        <strong>When you add options manually:</strong> If you delete an option after adding several options, you must delete them in
                        sequential order, starting from the last one. If you delete an option from the middle, the options after the one deleted will not
                        be imported.
                    </p>
                </div>
                <a href="javascript:void(0);" class="addCF btn btn-primary">Add More Options</a>
                <hr />
                <table class="table" id="customFields">
                    <tr class="success">
                        <th>Option</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Hours</th>
                        <th>Paint?</th>
                        <th></th>
                    </tr>
                    <tr>
                        <td><textarea name="addOptnMnlly[0].AddOptionManually" class="form-control" cols="100" rows="3" placeholder="Enter VSW Option"></textarea></td>
                        <td><input type="number" name="addOptnMnlly[0].AddQuantityManually" class="form-control" placeholder="Quantity"></td>
                        <td><input type="number" name="addOptnMnlly[0].AddPriceManually" class="form-control" placeholder="Price"></td>
                        <td><input type="number" name="addOptnMnlly[0].AddLaborHoursManually" class="form-control" placeholder="Labor Hours"></td>
                        <td><input type="checkbox" name="addOptnMnlly[0].AddPaintFlagManually" value="true"></td>
                        <td></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <hr />
    <div>
        <input type="submit" value="Save Quote" class="btn btn-primary" />
    </div>
}
<br />
<div>
    @Html.ActionLink("Back to Aerial Quote List", "Index")
</div>

@using (Script.Foot())
{
    <script type="text/javascript">
        $(function () {
            $("#accordion").accordion({
                heightStyle: "content",
                collapsible: true,
                active: false
            });
        });

        $(document).ready(function () {
            var x = 0; //initial text box count
            $(".addCF").click(function () {
                x++; //text box increment
                $("#customFields").append('<tr>'
                                            + '<td><textarea name="addOptnMnlly[' + x + '].AddOptionManually" class="form-control" cols="100" rows="3" placeholder="Enter VSW Option"></textarea></td>'
                                            + '<td><input type="number" name="addOptnMnlly[' + x + '].AddQuantityManually" class="form-control" placeholder="Quantity"></td>'
                                            + '<td><input type="number" name="addOptnMnlly[' + x + '].AddPriceManually" class="form-control" placeholder="Price"></td>'
                                            + '<td><input type="number" name="addOptnMnlly[' + x + '].AddLaborHoursManually" class="form-control" placeholder="Labor Hours"></td>'
                                            + '<td><input type="checkbox" name="addOptnMnlly[' + x + '].AddPaintFlagManually"  value="true"></td>'
                                            + '<td><a href="javascript:void(0);" class="remCF">Remove</a></td>'
                                            + '</tr>');
            });
            $("#customFields").on('click', '.remCF', function () {
                $(this).parent().parent().remove();
            });
        });
    </script>
}